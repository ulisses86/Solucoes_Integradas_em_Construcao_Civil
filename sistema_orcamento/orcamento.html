<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Sistema integrado de orçamentos para construção civil">
    <title>Orçamento Completo - SL Construção Civil</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'primary': '#0f172a',
                        'secondary': '#2563eb',
                        'accent': '#7c3aed',
                        'material': '#10b981',
                        'detail': '#3b82f6',
                        'light-gray': '#f8fafc',
                        'border-gray': '#e2e8f0',
                        'rental': '#f59e0b',
                        'teal': '#0d9488'
                    }
                }
            }
        }
    </script>
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        /* Estilos gerais */
        * {
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
        }
        
        .service-card {
            transition: all 0.3s ease;
            border: 2px solid transparent;
        }
        
        .service-card:hover {
            transform: translateY(-5px);
            border-color: #3b82f6;
            box-shadow: 0 10px 25px -5px rgba(59, 130, 246, 0.1);
        }
        
        .category-separator {
            background: linear-gradient(90deg, #e2e8f0 0%, #94a3b8 50%, #e2e8f0 100%);
            height: 1px;
            margin: 20px 0;
        }
        
        .rental-item {
            background: #fef3c7;
            border-left: 3px solid #f59e0b;
        }
        
        .profit-controls {
            background: #f0f9ff;
            border: 2px dashed #3b82f6;
            border-radius: 8px;
        }
        
        .drag-handle {
            cursor: move;
            opacity: 0.5;
            transition: opacity 0.2s ease;
        }
        
        .drag-handle:hover {
            opacity: 1;
        }
        
        /* Toast */
        #toast {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 9999;
            padding: 12px 16px;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 500;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            transition: all 0.3s ease;
            transform: translateX(150%);
        }
        
        /* Modal */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10000;
        }
        
        .modal-content {
            background: white;
            border-radius: 8px;
            max-width: 500px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
        }
        
        /* Estilo para edição de aluguel */
        .rental-edit {
            background-color: #fff8e1 !important;
        }
        
        /* Estilo para quebras de linha na descrição */
        #project-description {
            white-space: pre-wrap;
            word-wrap: break-word;
        }

        /* Modal de Cronograma */
        #schedule-modal .modal-content {
            max-width: 900px;
        }
        
        .etapa-days-slider {
            -webkit-appearance: none;
            width: 100%;
            height: 6px;
            background: #ddd;
            outline: none;
            border-radius: 3px;
        }
        
        .etapa-days-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 18px;
            height: 18px;
            background: #2563eb;
            border-radius: 50%;
            cursor: pointer;
        }
        
        .etapa-days-slider::-moz-range-thumb {
            width: 18px;
            height: 18px;
            background: #2563eb;
            border-radius: 50%;
            cursor: pointer;
            border: none;
        }
    </style>
</head>
<body class="bg-gray-50 min-h-screen">
    
    <!-- Cabeçalho -->
    <header class="bg-primary text-white py-4 px-6 no-print">
        <div class="max-w-7xl mx-auto">
            <div class="flex flex-col md:flex-row justify-between items-center gap-4">
                <div>
                    <h1 class="text-2xl font-black uppercase tracking-tight">SL CONSTRUÇÃO CIVIL</h1>
                    <p class="text-slate-300 text-sm">Sistema Integrado de Orçamentos</p>
                </div>
                
                <div class="flex items-center gap-4">
                    <div class="text-right">
                        <p class="text-sm">
                            ORÇAMENTO: <span id="budget-number" class="font-bold">001-2026</span>
                        </p>
                        <p class="text-xs text-slate-300" id="current-date"></p>
                    </div>
                    
                    <button onclick="saveDraft()" class="no-print bg-slate-700 hover:bg-slate-600 text-white px-4 py-2 rounded text-sm font-medium transition-colors">
                        <i class="fas fa-save mr-2"></i>Rascunho
                    </button>
                </div>
            </div>
        </div>
    </header>
    
    <!-- Barra de progresso -->
    <div class="bg-white border-b border-gray-200 py-2 px-6 no-print">
        <div class="max-w-7xl mx-auto">
            <div class="flex items-center justify-between">
                <div class="flex items-center gap-2">
                    <div class="w-2 h-2 bg-green-500 rounded-full"></div>
                    <span class="text-sm font-medium" id="progress-text">Selecione um serviço para começar</span>
                </div>
                
                <div class="flex gap-2">
                    <button onclick="toggleProfitControls()" class="no-print text-sm text-primary hover:text-secondary font-medium">
                        <i class="fas fa-chart-line mr-1"></i>Ajustar Margem
                    </button>
                    <button onclick="printBudget()" class="no-print bg-secondary hover:bg-blue-600 text-white px-4 py-2 rounded text-sm font-medium transition-colors">
                        <i class="fas fa-print mr-2"></i>Imprimir
                    </button>
                </div>
            </div>
        </div>
    </div>
    
    <main class="max-w-7xl mx-auto px-6 py-6">
        <!-- Grid de Serviços -->
        <section id="services-grid" class="mb-8 no-print">
            <h2 class="text-xl font-bold text-primary mb-4">Selecione os Serviços</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                <!-- Alvenaria -->
                <div class="service-card bg-white rounded-lg shadow border p-5 text-center cursor-pointer" 
                     onclick="openServiceCalculator('alvenaria')">
                    <div class="w-12 h-12 bg-amber-50 rounded-full flex items-center justify-center text-amber-600 mb-3 mx-auto">
                        <i class="fas fa-cubes text-xl"></i>
                    </div>
                    <h3 class="font-bold text-gray-800 mb-1">Alvenaria</h3>
                    <p class="text-sm text-gray-500">Muros, cercas e estruturas</p>
                    <div class="mt-3 text-xs text-green-600 font-medium hidden" id="alvenaria-badge">
                        <i class="fas fa-check-circle mr-1"></i>Adicionado
                    </div>
                </div>
                
                <!-- Pintura -->
                <div class="service-card bg-white rounded-lg shadow border p-5 text-center cursor-pointer"
                     onclick="openServiceCalculator('pintura')">
                    <div class="w-12 h-12 bg-blue-50 rounded-full flex items-center justify-center text-blue-600 mb-3 mx-auto">
                        <i class="fas fa-paint-roller text-xl"></i>
                    </div>
                    <h3 class="font-bold text-gray-800 mb-1">Pintura</h3>
                    <p class="text-sm text-gray-500">Paredes, tetos e fachadas</p>
                    <div class="mt-3 text-xs text-green-600 font-medium hidden" id="pintura-badge">
                        <i class="fas fa-check-circle mr-1"></i>Adicionado
                    </div>
                </div>
                
                <!-- Revestimentos -->
                <div class="service-card bg-white rounded-lg shadow border p-5 text-center cursor-pointer"
                     onclick="openServiceCalculator('revestimentos')">
                    <div class="w-12 h-12 bg-purple-50 rounded-full flex items-center justify-center text-purple-600 mb-3 mx-auto">
                        <i class="fas fa-th-large text-xl"></i>
                    </div>
                    <h3 class="font-bold text-gray-800 mb-1">Revestimentos</h3>
                    <p class="text-sm text-gray-500">Cerâmica, porcelanato, etc</p>
                    <div class="mt-3 text-xs text-green-600 font-medium hidden" id="pisos-badge">
                        <i class="fas fa-check-circle mr-1"></i>Adicionado
                    </div>
                </div>
                
                <!-- Reboco -->
                <div class="service-card bg-white rounded-lg shadow border p-5 text-center cursor-pointer"
                     onclick="openServiceCalculator('reboco')">
                    <div class="w-12 h-12 bg-stone-50 rounded-full flex items-center justify-center text-stone-600 mb-3 mx-auto">
                        <i class="fas fa-trowel text-xl"></i>
                    </div>
                    <h3 class="font-bold text-gray-800 mb-1">Reboco</h3>
                    <p class="text-sm text-gray-500">Chapisco e acabamento</p>
                    <div class="mt-3 text-xs text-green-600 font-medium hidden" id="reboco-badge">
                        <i class="fas fa-check-circle mr-1"></i>Adicionado
                    </div>
                </div>
                
                <!-- Telhado -->
                <div class="service-card bg-white rounded-lg shadow border p-5 text-center cursor-pointer"
                     onclick="openServiceCalculator('telhado')">
                    <div class="w-12 h-12 bg-red-50 rounded-full flex items-center justify-center text-red-600 mb-3 mx-auto">
                        <i class="fas fa-home text-xl"></i>
                    </div>
                    <h3 class="font-bold text-gray-800 mb-1">Telhado</h3>
                    <p class="text-sm text-gray-500">Estrutura e cobertura</p>
                    <div class="mt-3 text-xs text-green-600 font-medium hidden" id="telhado-badge">
                        <i class="fas fa-check-circle mr-1"></i>Adicionado
                    </div>
                </div>
                
                <!-- Aluguel de Equipamentos -->
                <div class="service-card bg-white rounded-lg shadow border p-5 text-center cursor-pointer"
                     onclick="openEquipmentRental()">
                    <div class="w-12 h-12 bg-orange-50 rounded-full flex items-center justify-center text-orange-600 mb-3 mx-auto">
                        <i class="fas fa-tools text-xl"></i>
                    </div>
                    <h3 class="font-bold text-gray-800 mb-1">Aluguel</h3>
                    <p class="text-sm text-gray-500">Equipamentos e ferramentas</p>
                    <div class="mt-3 text-xs text-green-600 font-medium hidden" id="aluguel-badge">
                        <i class="fas fa-check-circle mr-1"></i>Adicionado
                    </div>
                </div>
                
                <!-- Personalizado -->
                <div class="service-card bg-white rounded-lg shadow border p-5 text-center cursor-pointer"
                     onclick="addCustomService()">
                    <div class="w-12 h-12 bg-green-50 rounded-full flex items-center justify-center text-green-600 mb-3 mx-auto">
                        <i class="fas fa-plus-circle text-xl"></i>
                    </div>
                    <h3 class="font-bold text-gray-800 mb-1">Personalizado</h3>
                    <p class="text-sm text-gray-500">Serviço à parte</p>
                    <div class="mt-3 text-xs text-green-600 font-medium hidden" id="personalizado-badge">
                        <i class="fas fa-check-circle mr-1"></i>Adicionado
                    </div>
                </div>
                
                <!-- Laudo Técnico -->
                <div class="service-card bg-white rounded-lg shadow border p-5 text-center cursor-pointer"
                     onclick="openLaudoTecnico()">
                    <div class="w-12 h-12 bg-teal-50 rounded-full flex items-center justify-center text-teal-600 mb-3 mx-auto">
                        <i class="fas fa-file-contract text-xl"></i>
                    </div>
                    <h3 class="font-bold text-gray-800 mb-1">Laudo Técnico</h3>
                    <p class="text-sm text-gray-500">Vistoria e elaboração de laudo</p>
                    <div class="mt-3 text-xs text-green-600 font-medium hidden" id="laudo-badge">
                        <i class="fas fa-check-circle mr-1"></i>Adicionado
                    </div>
                </div>
            </div>
        </section>
        
        <!-- Controles de Margem -->
        <section id="profit-controls" class="profit-controls p-4 mb-6 hidden no-print">
            <div class="flex flex-col md:flex-row justify-between items-center gap-4">
                <div class="flex-1">
                    <h3 class="font-bold text-primary mb-2">Controles de Margem e Prazos</h3>
                    <p class="text-sm text-gray-600">Ajuste o lucro, desconto e prazos totais</p>
                </div>
                
                <div class="flex flex-wrap gap-4">
                    <div>
                        <label class="block text-xs font-medium text-gray-700 mb-1">Margem de Lucro (%)</label>
                        <div class="flex items-center gap-2">
                            <input type="number" id="profit-margin" value="30" min="0" max="100" 
                                   class="w-20 px-2 py-1 border rounded" onchange="updateTotals()">
                            <button onclick="applyProfitMargin()" class="bg-green-600 text-white px-3 py-1 rounded text-xs">
                                Aplicar
                            </button>
                        </div>
                    </div>
                    
                    <div>
                        <label class="block text-xs font-medium text-gray-700 mb-1">Desconto (R$)</label>
                        <div class="flex items-center gap-2">
                            <input type="number" id="discount" value="0" min="0" step="0.01"
                                   class="w-28 px-2 py-1 border rounded" onchange="updateTotals()">
                            <button onclick="applyDiscount()" class="bg-blue-600 text-white px-3 py-1 rounded text-xs">
                                Aplicar
                            </button>
                        </div>
                    </div>
                    
                    <div>
                        <label class="block text-xs font-medium text-gray-700 mb-1">Prazo Total (dias)</label>
                        <div class="flex items-center gap-2">
                            <input type="number" id="total-days" value="0" min="0"
                                   class="w-20 px-2 py-1 border rounded" onchange="applySchedule()">
                            <button onclick="applySchedule()" class="bg-purple-600 text-white px-3 py-1 rounded text-xs">
                                Definir
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </section>
        
        <!-- Tabela de Orçamento -->
        <section id="budget-table-section" class="bg-white rounded-lg shadow border">
            <!-- Cabeçalho da tabela -->
            <div class="section-header px-6 py-4 rounded-t-lg no-print">
                <div class="flex flex-col md:flex-row justify-between items-start md:items-center gap-4">
                    <div>
                        <h2 class="text-xl font-bold text-primary">Orçamento Detalhado</h2>
                        <p class="text-sm text-gray-600">Arraste os itens para reordenar</p>
                    </div>
                    
                    <div class="flex gap-2">
                        <button onclick="clearBudget()" class="no-print text-red-600 hover:text-red-700 text-sm font-medium">
                            <i class="fas fa-trash-alt mr-1"></i>Limpar Tudo
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- Tabela -->
            <div class="overflow-x-auto">
                <table class="w-full">
                    <thead class="bg-primary text-white">
                        <tr>
                            <th class="p-3 text-left font-bold w-8 drag-handle">#</th>
                            <th class="p-3 text-left font-bold min-w-[250px]">Descrição do Serviço</th>
                            <th class="p-3 text-center font-bold w-24">Quantidade</th>
                            <th class="p-3 text-center font-bold w-32">Unidade</th>
                            <th class="p-3 text-center font-bold w-36">Valor Unitário</th>
                            <th class="p-3 text-center font-bold w-36">Subtotal</th>
                            <th class="p-3 text-center font-bold w-20 actions-column">Ações</th>
                        </tr>
                    </thead>
                    <tbody id="budget-table-body" class="divide-y divide-gray-200">
                        <!-- Linha inicial vazia -->
                        <tr id="empty-table-message">
                            <td colspan="7" class="p-8 text-center text-gray-500">
                                <i class="fas fa-calculator text-4xl mb-3 opacity-50"></i>
                                <p class="text-lg font-medium">Nenhum serviço adicionado</p>
                                <p class="text-sm mt-1">Selecione um serviço acima para começar o orçamento</p>
                            </td>
                        </tr>
                    </tbody>
                    
                    <!-- Totais por categoria -->
                    <tbody id="category-totals" class="bg-gray-50">
                        <!-- Totais serão inseridos aqui dinamicamente -->
                    </tbody>
                    
                    <!-- Totais gerais -->
                    <tfoot class="bg-gray-100 border-t-2 border-gray-300">
                        <tr>
                            <td colspan="4" class="p-4 text-right font-bold text-lg">TOTAL GERAL:</td>
                            <td class="p-4 text-center font-bold text-lg" id="total-labor">R$ 0,00</td>
                            <td class="p-4 text-center font-bold text-lg text-primary" id="total-final">R$ 0,00</td>
                            <td class="p-4 actions-column"></td>
                        </tr>
                        <tr id="profit-discount-row" class="hidden">
                            <td colspan="4" class="p-2 text-right text-sm">Desconto:</td>
                            <td colspan="2" class="p-2 text-center text-sm" id="profit-discount-amount">R$ 0,00</td>
                            <td class="p-2 actions-column"></td>
                        </tr>
                    </tfoot>
                </table>
            </div>
            
            <!-- Resumo de Prazos -->
            <div id="schedule-summary" class="p-4 border-t border-gray-200 bg-blue-50 hidden">
                <h3 class="font-bold text-primary mb-2">Resumo de Prazos</h3>
                <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                    <div class="text-center">
                        <div class="text-sm text-gray-600">Prazo Total</div>
                        <div class="text-xl font-bold" id="total-days-display">0 dias</div>
                    </div>
                    <div class="text-center">
                        <div class="text-sm text-gray-600">Início Previsto</div>
                        <div class="text-lg font-medium" id="start-date">--/--/----</div>
                    </div>
                    <div class="text-center">
                        <div class="text-sm text-gray-600">Término Previsto</div>
                        <div class="text-lg font-medium" id="end-date">--/--/----</div>
                    </div>
                    <div class="text-center">
                        <button onclick="showScheduleModal()" class="no-print bg-secondary hover:bg-blue-600 text-white px-4 py-2 rounded text-sm font-medium">
                            <i class="fas fa-calendar-alt mr-2"></i>Planejar Cronograma
                        </button>
                    </div>
                </div>
            </div>
        </section>
        
        <!-- Descrição Adicional -->
        <section id="description-section" class="mt-6 hidden">
            <div class="bg-white rounded-lg shadow border p-6">
                <h3 class="font-bold text-primary mb-4">Descrição do Projeto</h3>
                <div contenteditable="true" id="project-description" 
                     class="min-h-[100px] border border-gray-300 rounded p-4 focus:outline-none focus:ring-2 focus:ring-blue-500 whitespace-pre-wrap"
                     data-placeholder="Descreva detalhadamente o projeto, incluindo especificações, condições e observações importantes...">
                </div>
            </div>
        </section>
        
        <!-- Assinaturas -->
        <section id="signatures-section" class="mt-6 hidden">
            <div class="bg-white rounded-lg shadow border p-6">
                <h3 class="font-bold text-primary mb-4">Dados do Cliente e Responsável Técnico</h3>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Cliente</label>
                        <input type="text" id="client-name" class="w-full px-3 py-2 border rounded" placeholder="Nome do cliente">
                        <label class="block text-sm font-medium text-gray-700 mb-2 mt-4">Endereço</label>
                        <input type="text" id="client-address" class="w-full px-3 py-2 border rounded" placeholder="Endereço completo">
                        <label class="block text-sm font-medium text-gray-700 mb-2 mt-4">CPF/CNPJ</label>
                        <input type="text" id="client-document" class="w-full px-3 py-2 border rounded" placeholder="CPF ou CNPJ">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Responsável Técnico</label>
                        <input type="text" id="technical-responsible" class="w-full px-3 py-2 border rounded" placeholder="Nome do responsável">
                        <label class="block text-sm font-medium text-gray-700 mb-2 mt-4">CREA/Registro</label>
                        <input type="text" id="technical-register" class="w-full px-3 py-2 border rounded" placeholder="Número do registro">
                        <label class="block text-sm font-medium text-gray-700 mb-2 mt-4">Contato</label>
                        <input type="text" id="technical-contact" class="w-full px-3 py-2 border rounded" placeholder="Telefone/Email">
                    </div>
                </div>
            </div>
        </section>
    </main>
    
    <!-- Modal de Aluguel de Equipamentos -->
    <div id="equipment-modal" class="modal-overlay hidden">
        <div class="modal-content p-6">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-xl font-bold text-primary">Aluguel de Equipamentos</h3>
                <button onclick="closeEquipmentModal()" class="text-gray-500 hover:text-gray-700">
                    <i class="fas fa-times text-xl"></i>
                </button>
            </div>
            
            <div class="mb-6">
                <p class="text-gray-600 mb-4">Selecione os equipamentos e defina a quantidade:</p>
                
                <div class="mb-6">
                    <label class="block text-sm font-medium text-gray-700 mb-2">Período de Aluguel (dias)</label>
                    <input type="number" id="rental-days" min="1" value="8" 
                           class="w-full px-3 py-2 border rounded">
                </div>
                
                <div class="overflow-y-auto max-h-64">
                    <table class="w-full border-collapse">
                        <thead>
                            <tr class="bg-gray-100">
                                <th class="p-2 text-left text-sm font-medium">Equipamento</th>
                                <th class="p-2 text-center text-sm font-medium w-24">Adicionar</th>
                            </tr>
                        </thead>
                        <tbody id="equipment-list">
                            <!-- Lista carregada do JSON -->
                        </tbody>
                    </table>
                </div>
            </div>
            
            <div class="flex justify-end gap-3">
                <button onclick="closeEquipmentModal()" 
                        class="px-4 py-2 border border-gray-300 rounded text-gray-700 hover:bg-gray-50">
                    Cancelar
                </button>
                <button onclick="addSelectedEquipment()" 
                        class="px-4 py-2 bg-rental hover:bg-amber-600 text-white rounded">
                    <i class="fas fa-plus mr-2"></i>Adicionar Selecionados
                </button>
            </div>
        </div>
    </div>
    
        <!-- Modal de Serviço Personalizado -->
        <div id="custom-service-modal" class="modal-overlay hidden">
            <div class="modal-content p-6 max-w-md">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-xl font-bold text-primary">Serviço Personalizado</h3>
                    <button onclick="closeCustomModal()" class="text-gray-500 hover:text-gray-700">
                        <i class="fas fa-times text-xl"></i>
                    </button>
                </div>

                <div class="text-gray-700 text-sm leading-relaxed">
                    <p>
                        O serviço personalizado permite cadastrar itens fora do padrão
                        do orçamento, como:
                    </p>

                    <ul class="list-disc list-inside mt-3 space-y-1">
                        <li>Serviços específicos</li>
                        <li>Ajustes manuais</li>
                        <li>Demandas especiais do cliente</li>
                    </ul>

                    <p class="mt-4 text-gray-600">
                        Clique no botão abaixo para acessar o cadastro completo.
                    </p>
                </div>

                <div class="flex justify-end gap-3 mt-6">
                    <button onclick="closeCustomModal()" 
                            class="px-4 py-2 border border-gray-300 rounded text-gray-700 hover:bg-gray-50">
                        Cancelar
                    </button>
                    <button onclick="openPersonalizadoForm()" 
                            class="px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded">
                        Abrir Cadastro
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- JavaScript externo -->
    <script src="./js/orcamento.js"></script>
</body>
</html>
